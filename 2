-- ════════════════════════════════════════════════════════════════
-- iOS 18 CONTROL CENTER STYLE GUI
-- ════════════════════════════════════════════════════════════════
-- Этот файл содержит все элементы интерфейса


local gui = Instance.new("ScreenGui")
gui.IgnoreGuiInset = true
gui.ResetOnSpawn = false
gui.Name = "FennixAimUI"
gui.Parent = Services.CoreGui

local blurEffect = Instance.new("BlurEffect")
blurEffect.Size = 0
blurEffect.Parent = game:GetService("Lighting")

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, Config.GUISize.Width, 0, Config.GUISize.Height)
mainFrame.Position = UDim2.new(0.5, -Config.GUISize.Width/2, 0.5, -Config.GUISize.Height/2)
mainFrame.BackgroundColor3 = Config.GUIColor
mainFrame.BorderSizePixel = 0
mainFrame.BackgroundTransparency = Config.GUITransparency
mainFrame.Active = true
mainFrame.ClipsDescendants = false
mainFrame.Visible = false
mainFrame.Parent = gui

local mainCorner = Instance.new("UICorner", mainFrame)
mainCorner.CornerRadius = UDim.new(0, 28)

local mainStroke = Instance.new("UIStroke", mainFrame)
mainStroke.Color = Color3.fromRGB(210, 210, 215)
mainStroke.Thickness = 1
mainStroke.Transparency = 0.5

local titleBar = Instance.new("Frame")
titleBar.Size = UDim2.new(1, 0, 0, 70)
titleBar.BackgroundTransparency = 1
titleBar.Parent = mainFrame

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -40, 1, 0)
title.Position = UDim2.new(0, 20, 0, 0)
title.Text = "FENNIXXX"
title.TextColor3 = Color3.fromRGB(0, 0, 0)
title.TextSize = 26
title.Font = Enum.Font.GothamBold
title.BackgroundTransparency = 1
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = titleBar

local resizing = false
local resizeDirection = nil
local resizeStart = nil
local startSize = nil
local startPos = nil

local function createInvisibleHandle(sizeProp, posProp, cursor)
    local handle = Instance.new("Frame")
    handle.Size = sizeProp
    handle.Position = posProp
    handle.BackgroundTransparency = 1
    handle.BorderSizePixel = 0
    handle.Parent = mainFrame
    handle.ZIndex = 10
    return handle
end

local rightHandle = createInvisibleHandle(UDim2.new(0, 10, 1, 0), UDim2.new(1, -5, 0, 0))
local leftHandle = createInvisibleHandle(UDim2.new(0, 10, 1, 0), UDim2.new(0, -5, 0, 0))
local bottomHandle = createInvisibleHandle(UDim2.new(1, 0, 0, 10), UDim2.new(0, 0, 1, -5))
local topHandle = createInvisibleHandle(UDim2.new(1, 0, 0, 10), UDim2.new(0, 0, 0, -5))
local cornerBR = createInvisibleHandle(UDim2.new(0, 20, 0, 20), UDim2.new(1, -10, 1, -10))
local cornerBL = createInvisibleHandle(UDim2.new(0, 20, 0, 20), UDim2.new(0, -10, 1, -10))
local cornerTR = createInvisibleHandle(UDim2.new(0, 20, 0, 20), UDim2.new(1, -10, 0, -10))
local cornerTL = createInvisibleHandle(UDim2.new(0, 20, 0, 20), UDim2.new(0, -10, 0, -10))

local function setupResize(handle, direction)
    handle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            resizing = true
            resizeDirection = direction
            resizeStart = Services.UserInputService:GetMouseLocation()
            startSize = mainFrame.Size
            startPos = mainFrame.Position
        end
    end)
    
    handle.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 and resizeDirection == direction then
            resizing = false
            resizeDirection = nil
        end
    end)
end

setupResize(rightHandle, "right")
setupResize(leftHandle, "left")
setupResize(bottomHandle, "bottom")
setupResize(topHandle, "top")
setupResize(cornerBR, "corner-br")
setupResize(cornerBL, "corner-bl")
setupResize(cornerTR, "corner-tr")
setupResize(cornerTL, "corner-tl")

Services.RunService.RenderStepped:Connect(function()
    if resizing and resizeDirection then
        local currentMouse = Services.UserInputService:GetMouseLocation()
        local delta = currentMouse - resizeStart
        
        if resizeDirection == "right" then
            local newWidth = math.clamp(startSize.X.Offset + delta.X, 500, 1200)
            mainFrame.Size = UDim2.new(0, newWidth, 0, startSize.Y.Offset)
            Config.GUISize.Width = newWidth
        elseif resizeDirection == "left" then
            local newWidth = math.clamp(startSize.X.Offset - delta.X, 500, 1200)
            mainFrame.Size = UDim2.new(0, newWidth, 0, startSize.Y.Offset)
            mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + (startSize.X.Offset - newWidth), startPos.Y.Scale, startPos.Y.Offset)
            Config.GUISize.Width = newWidth
        elseif resizeDirection == "bottom" then
            local newHeight = math.clamp(startSize.Y.Offset + delta.Y, 500, 1200)
            mainFrame.Size = UDim2.new(0, startSize.X.Offset, 0, newHeight)
            Config.GUISize.Height = newHeight
        elseif resizeDirection == "top" then
            local newHeight = math.clamp(startSize.Y.Offset - delta.Y, 500, 1200)
            mainFrame.Size = UDim2.new(0, startSize.X.Offset, 0, newHeight)
            mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset, startPos.Y.Scale, startPos.Y.Offset + (startSize.Y.Offset - newHeight))
            Config.GUISize.Height = newHeight
        elseif resizeDirection == "corner-br" then
            local newWidth = math.clamp(startSize.X.Offset + delta.X, 500, 1200)
            local newHeight = math.clamp(startSize.Y.Offset + delta.Y, 500, 1200)
            mainFrame.Size = UDim2.new(0, newWidth, 0, newHeight)
            Config.GUISize.Width = newWidth
            Config.GUISize.Height = newHeight
        elseif resizeDirection == "corner-bl" then
            local newWidth = math.clamp(startSize.X.Offset - delta.X, 500, 1200)
            local newHeight = math.clamp(startSize.Y.Offset + delta.Y, 500, 1200)
            mainFrame.Size = UDim2.new(0, newWidth, 0, newHeight)
            mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + (startSize.X.Offset - newWidth), startPos.Y.Scale, startPos.Y.Offset)
            Config.GUISize.Width = newWidth
            Config.GUISize.Height = newHeight
        elseif resizeDirection == "corner-tr" then
            local newWidth = math.clamp(startSize.X.Offset + delta.X, 500, 1200)
            local newHeight = math.clamp(startSize.Y.Offset - delta.Y, 500, 1200)
            mainFrame.Size = UDim2.new(0, newWidth, 0, newHeight)
            mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset, startPos.Y.Scale, startPos.Y.Offset + (startSize.Y.Offset - newHeight))
            Config.GUISize.Width = newWidth
            Config.GUISize.Height = newHeight
        elseif resizeDirection == "corner-tl" then
            local newWidth = math.clamp(startSize.X.Offset - delta.X, 500, 1200)
            local newHeight = math.clamp(startSize.Y.Offset - delta.Y, 500, 1200)
            mainFrame.Size = UDim2.new(0, newWidth, 0, newHeight)
            mainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + (startSize.X.Offset - newWidth), startPos.Y.Scale, startPos.Y.Offset + (startSize.Y.Offset - newHeight))
            Config.GUISize.Width = newWidth
            Config.GUISize.Height = newHeight
        end
    end
end)

local dragging = false
local dragStart = nil
local startPosFrame = nil

titleBar.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = Services.UserInputService:GetMouseLocation()
        startPosFrame = mainFrame.Position
    end
end)

Services.UserInputService.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = false
    end
end)

Services.RunService.RenderStepped:Connect(function()
    if dragging and not resizing then
        local currentMouse = Services.UserInputService:GetMouseLocation()
        local delta = currentMouse - dragStart
        mainFrame.Position = UDim2.new(
            startPosFrame.X.Scale,
            startPosFrame.X.Offset + delta.X,
            startPosFrame.Y.Scale,
            startPosFrame.Y.Offset + delta.Y
        )
    end
end)

local scrollFrame = Instance.new("ScrollingFrame")
scrollFrame.Size = UDim2.new(1, -24, 1, -90)
scrollFrame.Position = UDim2.new(0, 12, 0, 78)
scrollFrame.BackgroundTransparency = 1
scrollFrame.BorderSizePixel = 0
scrollFrame.ScrollBarThickness = 6
scrollFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
scrollFrame.ScrollBarImageColor3 = Color3.fromRGB(142, 142, 147)
scrollFrame.Parent = mainFrame

local scrollLayout = Instance.new("UIListLayout")
scrollLayout.Parent = scrollFrame
scrollLayout.SortOrder = Enum.SortOrder.LayoutOrder
scrollLayout.Padding = UDim.new(0, 12)
scrollLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

scrollLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    scrollFrame.CanvasSize = UDim2.new(0, 0, 0, scrollLayout.AbsoluteContentSize.Y + 20)
end)

local function updateGUIColors(newColor)
    Config.AccentColor = newColor
    FOVCircle.Color = newColor
    MultipointCircle.Color = newColor
    
    for _, obj in pairs(scrollFrame:GetDescendants()) do
        if obj:IsA("TextLabel") and obj.Name == "ValueLabel" then
            obj.TextColor3 = newColor
        elseif obj:IsA("Frame") and obj.Name == "SliderFill" then
            obj.BackgroundColor3 = newColor
        elseif obj:IsA("TextButton") then
            if obj.Parent and obj.Parent:IsA("Frame") then
                local parentFrame = obj.Parent
                if parentFrame.Name:find("Keybind") then
                    if obj.Text ~= "..." then
                        obj.TextColor3 = newColor
                    end
                end
            end
        end
    end
end

local function createCircleButton(name, order, defaultValue, callback)
    local container = Instance.new("Frame")
    container.Size = UDim2.new(0, 120, 0, 135)
    container.BackgroundTransparency = 1
    container.LayoutOrder = order
    
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(0, 100, 0, 100)
    button.Position = UDim2.new(0.5, -50, 0, 0)
    button.BackgroundColor3 = defaultValue and Color3.fromRGB(52, 199, 89) or Color3.fromRGB(255, 255, 255)
    button.Text = ""
    button.BorderSizePixel = 0
    button.BackgroundTransparency = 0.15
    button.Parent = container
    
    local btnCorner = Instance.new("UICorner", button)
    btnCorner.CornerRadius = UDim.new(1, 0)
    
    local btnStroke = Instance.new("UIStroke", button)
    btnStroke.Color = Color3.fromRGB(210, 210, 215)
    btnStroke.Thickness = 2
    btnStroke.Transparency = defaultValue and 1 or 0.5
    
    local iconLabel = Instance.new("TextLabel")
    iconLabel.Size = UDim2.new(1, 0, 1, 0)
    iconLabel.Position = UDim2.new(0, 0, 0, 0)
    iconLabel.BackgroundTransparency = 1
    iconLabel.Text = name:sub(1, 1):upper()
    iconLabel.TextColor3 = defaultValue and Color3.fromRGB(255, 255, 255) or Color3.fromRGB(100, 100, 105)
    iconLabel.TextSize = 32
    iconLabel.Font = Enum.Font.GothamBold
    iconLabel.TextYAlignment = Enum.TextYAlignment.Center
    iconLabel.Parent = button
    
    local nameLabel = Instance.new("TextLabel")
    nameLabel.Size = UDim2.new(1, 0, 0, 30)
    nameLabel.Position = UDim2.new(0, 0, 0, 105)
    nameLabel.BackgroundTransparency = 1
    nameLabel.Text = name
    nameLabel.TextColor3 = Color3.fromRGB(0, 0, 0)
    nameLabel.TextSize = 12
    nameLabel.Font = Enum.Font.Gotham
    nameLabel.TextWrapped = true
    nameLabel.TextYAlignment = Enum.TextYAlignment.Top
    nameLabel.Parent = container
    
    local enabled = defaultValue
    
    button.MouseButton1Click:Connect(function()
        enabled = not enabled
        
        Services.TweenService:Create(button, TweenInfo.new(0.25), {
            BackgroundColor3 = enabled and Color3.fromRGB(52, 199, 89) or Color3.fromRGB(255, 255, 255)
        }):Play()
        
        Services.TweenService:Create(btnStroke, TweenInfo.new(0.25), {
            Transparency = enabled and 1 or 0.5
        }):Play()
        
        Services.TweenService:Create(iconLabel, TweenInfo.new(0.25), {
            TextColor3 = enabled and Color3.fromRGB(255, 255, 255) or Color3.fromRGB(100, 100, 105)
        }):Play()
        
        callback(enabled)
    end)
    
    return container, button
end

local function createModuleSection(title, order)
    local section = Instance.new("Frame")
    section.Size = UDim2.new(0, scrollFrame.AbsoluteSize.X - 12, 0, 45)
    section.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    section.BorderSizePixel = 0
    section.BackgroundTransparency = 0.3
    section.LayoutOrder = order
    section.Parent = scrollFrame
    
    local sectionCorner = Instance.new("UICorner", section)
    sectionCorner.CornerRadius = UDim.new(0, 16)
    
    local sectionTitle = Instance.new("TextLabel")
    sectionTitle.Size = UDim2.new(1, -20, 1, 0)
    sectionTitle.Position = UDim2.new(0, 16, 0, 0)
    sectionTitle.Text = title
    sectionTitle.TextColor3 = Color3.fromRGB(0, 0, 0)
    sectionTitle.TextSize = 18
    sectionTitle.Font = Enum.Font.GothamBold
    sectionTitle.BackgroundTransparency = 1
    sectionTitle.TextXAlignment = Enum.TextXAlignment.Left
    sectionTitle.TextYAlignment = Enum.TextYAlignment.Center
    sectionTitle.Parent = section
    
    return section
end

local function createModernSlider(name, order, min, max, defaultValue, callback, isDecimal)
    local sliderFrame = Instance.new("Frame")
    sliderFrame.Size = UDim2.new(0, scrollFrame.AbsoluteSize.X - 12, 0, 75)
    sliderFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    sliderFrame.BorderSizePixel = 0
    sliderFrame.BackgroundTransparency = 0.3
    sliderFrame.LayoutOrder = order
    sliderFrame.Parent = scrollFrame
    
    local sliderCorner = Instance.new("UICorner", sliderFrame)
    sliderCorner.CornerRadius = UDim.new(0, 16)
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.5, 0, 0, 26)
    label.Position = UDim2.new(0, 16, 0, 12)
    label.Text = name
    label.TextColor3 = Color3.fromRGB(0, 0, 0)
    label.TextSize = 15
    label.Font = Enum.Font.GothamMedium
    label.BackgroundTransparency = 1
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.TextYAlignment = Enum.TextYAlignment.Center
    label.Parent = sliderFrame
    
    local valueLabel = Instance.new("TextLabel")
    valueLabel.Name = "ValueLabel"
    valueLabel.Size = UDim2.new(0.45, 0, 0, 26)
    valueLabel.Position = UDim2.new(0.55, -16, 0, 12)
    valueLabel.Text = isDecimal and string.format("%.2f", defaultValue) or tostring(defaultValue)
    valueLabel.TextColor3 = Config.AccentColor
    valueLabel.TextSize = 15
    valueLabel.Font = Enum.Font.GothamBold
    valueLabel.BackgroundTransparency = 1
    valueLabel.TextXAlignment = Enum.TextXAlignment.Right
    valueLabel.TextYAlignment = Enum.TextYAlignment.Center
    valueLabel.Parent = sliderFrame
    
    local sliderBg = Instance.new("Frame")
    sliderBg.Size = UDim2.new(1, -32, 0, 8)
    sliderBg.Position = UDim2.new(0, 16, 0, 52)
    sliderBg.BackgroundColor3 = Color3.fromRGB(220, 220, 225)
    sliderBg.BorderSizePixel = 0
    sliderBg.Parent = sliderFrame
    
    local sliderBgCorner = Instance.new("UICorner", sliderBg)
    sliderBgCorner.CornerRadius = UDim.new(1, 0)
    
    local sliderFill = Instance.new("Frame")
    sliderFill.Name = "SliderFill"
    sliderFill.Size = UDim2.new((defaultValue - min) / (max - min), 0, 1, 0)
    sliderFill.BackgroundColor3 = Config.AccentColor
    sliderFill.BorderSizePixel = 0
    sliderFill.Parent = sliderBg
    
    local sliderFillCorner = Instance.new("UICorner", sliderFill)
    sliderFillCorner.CornerRadius = UDim.new(1, 0)
    
    local dragging = false
    sliderBg.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
        end
    end)
    
    Services.UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    Services.RunService.RenderStepped:Connect(function()
        if dragging then
            local mousePos = Services.UserInputService:GetMouseLocation()
            local relX = math.clamp((mousePos.X - sliderBg.AbsolutePosition.X) / sliderBg.AbsoluteSize.X, 0, 1)
            
            Services.TweenService:Create(sliderFill, TweenInfo.new(0.1), {
                Size = UDim2.new(relX, 0, 1, 0)
            }):Play()
            
            local value = min + (max - min) * relX
            if not isDecimal then
                value = math.floor(value)
            end
            
            valueLabel.Text = isDecimal and string.format("%.2f", value) or tostring(value)
            callback(value)
        end
    end)
    
    return sliderFrame
end

local function createCompactToggle(name, order, defaultValue, callback)
    local toggleFrame = Instance.new("Frame")
    toggleFrame.Size = UDim2.new(0, scrollFrame.AbsoluteSize.X - 12, 0, 52)
    toggleFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    toggleFrame.BorderSizePixel = 0
    toggleFrame.BackgroundTransparency = 0.3
    toggleFrame.LayoutOrder = order
    toggleFrame.Parent = scrollFrame
    
    local toggleCorner = Instance.new("UICorner", toggleFrame)
    toggleCorner.CornerRadius = UDim.new(0, 16)
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.65, 0, 1, 0)
    label.Position = UDim2.new(0, 16, 0, 0)
    label.Text = name
    label.TextColor3 = Color3.fromRGB(0, 0, 0)
    label.TextSize = 15
    label.Font = Enum.Font.Gotham
    label.BackgroundTransparency = 1
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.TextYAlignment = Enum.TextYAlignment.Center
    label.Parent = toggleFrame
    
    local toggle = Instance.new("TextButton")
    toggle.Size = UDim2.new(0, 51, 0, 31)
    toggle.Position = UDim2.new(1, -67, 0.5, -15.5)
    toggle.BackgroundColor3 = defaultValue and Color3.fromRGB(52, 199, 89) or Color3.fromRGB(220, 220, 225)
    toggle.Text = ""
    toggle.BorderSizePixel = 0
    toggle.Parent = toggleFrame
    
    local toggleCorner2 = Instance.new("UICorner", toggle)
    toggleCorner2.CornerRadius = UDim.new(1, 0)
    
    local circle = Instance.new("Frame")
    circle.Size = UDim2.new(0, 27, 0, 27)
    circle.Position = defaultValue and UDim2.new(0, 22, 0, 2) or UDim2.new(0, 2, 0, 2)
    circle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    circle.BorderSizePixel = 0
    circle.Parent = toggle
    
    local circleCorner = Instance.new("UICorner", circle)
    circleCorner.CornerRadius = UDim.new(1, 0)
    
    local enabled = defaultValue
    
    toggle.MouseButton1Click:Connect(function()
        enabled = not enabled
        
        Services.TweenService:Create(toggle, TweenInfo.new(0.25), {
            BackgroundColor3 = enabled and Color3.fromRGB(52, 199, 89) or Color3.fromRGB(220, 220, 225)
        }):Play()
        
        Services.TweenService:Create(circle, TweenInfo.new(0.25), {
            Position = enabled and UDim2.new(0, 22, 0, 2) or UDim2.new(0, 2, 0, 2)
        }):Play()
        
        callback(enabled)
    end)
    
    return toggleFrame
end

local function createDropdown(name, order, options, defaultValue, callback)
    local dropdownFrame = Instance.new("Frame")
    dropdownFrame.Size = UDim2.new(0, scrollFrame.AbsoluteSize.X - 12, 0, 52)
    dropdownFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    dropdownFrame.BorderSizePixel = 0
    dropdownFrame.BackgroundTransparency = 0.3
    dropdownFrame.LayoutOrder = order
    dropdownFrame.ClipsDescendants = false
    dropdownFrame.Parent = scrollFrame
    
    local dropdownCorner = Instance.new("UICorner", dropdownFrame)
    dropdownCorner.CornerRadius = UDim.new(0, 16)
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.35, 0, 1, 0)
    label.Position = UDim2.new(0, 16, 0, 0)
    label.Text = name
    label.TextColor3 = Color3.fromRGB(0, 0, 0)
    label.TextSize = 15
    label.Font = Enum.Font.Gotham
    label.BackgroundTransparency = 1
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.TextYAlignment = Enum.TextYAlignment.Center
    label.Parent = dropdownFrame
    
    local selectedBtn = Instance.new("TextButton")
    selectedBtn.Size = UDim2.new(0.6, -16, 0, 36)
    selectedBtn.Position = UDim2.new(0.4, 0, 0.5, -18)
    selectedBtn.BackgroundColor3 = Color3.fromRGB(242, 242, 247)
    selectedBtn.Text = defaultValue
    selectedBtn.TextColor3 = Color3.fromRGB(0, 0, 0)
    selectedBtn.TextSize = 14
    selectedBtn.Font = Enum.Font.GothamMedium
    selectedBtn.BorderSizePixel = 0
    selectedBtn.Parent = dropdownFrame
    
    local selectedCorner = Instance.new("UICorner", selectedBtn)
    selectedCorner.CornerRadius = UDim.new(0, 10)
    
    local optionsFrame = Instance.new("Frame")
    optionsFrame.Size = UDim2.new(0.6, -16, 0, 0)
    optionsFrame.Position = UDim2.new(0.4, 0, 1, 4)
    optionsFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    optionsFrame.BorderSizePixel = 0
    optionsFrame.Visible = false
    optionsFrame.ClipsDescendants = true
    optionsFrame.ZIndex = 100
    optionsFrame.Parent = dropdownFrame
    
    local optionsCorner = Instance.new("UICorner", optionsFrame)
    optionsCorner.CornerRadius = UDim.new(0, 12)
    
    local optionsLayout = Instance.new("UIListLayout", optionsFrame)
    optionsLayout.SortOrder = Enum.SortOrder.LayoutOrder
    optionsLayout.Padding = UDim.new(0, 2)
    
    local isOpen = false
    
    selectedBtn.MouseButton1Click:Connect(function()
        isOpen = not isOpen
        
        if isOpen then
            optionsFrame.Visible = true
            Services.TweenService:Create(optionsFrame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
                Size = UDim2.new(0.6, -16, 0, #options * 38 + 4)
            }):Play()
        else
            Services.TweenService:Create(optionsFrame, TweenInfo.new(0.2), {
                Size = UDim2.new(0.6, -16, 0, 0)
            }):Play()
            wait(0.2)
            optionsFrame.Visible = false
        end
    end)
    
    for i, option in ipairs(options) do
        local optionBtn = Instance.new("TextButton")
        optionBtn.Size = UDim2.new(1, -4, 0, 36)
        optionBtn.Position = UDim2.new(0, 2, 0, 0)
        optionBtn.BackgroundColor3 = option == defaultValue and Color3.fromRGB(0, 122, 255) or Color3.fromRGB(242, 242, 247)
        optionBtn.Text = option
        optionBtn.TextColor3 = option == defaultValue and Color3.fromRGB(255, 255, 255) or Color3.fromRGB(0, 0, 0)
        optionBtn.TextSize = 13
        optionBtn.Font = Enum.Font.Gotham
        optionBtn.BorderSizePixel = 0
        optionBtn.LayoutOrder = i
        optionBtn.Parent = optionsFrame
        
        local optionCorner = Instance.new("UICorner", optionBtn)
        optionCorner.CornerRadius = UDim.new(0, 8)
        
        optionBtn.MouseButton1Click:Connect(function()
            selectedBtn.Text = option
            callback(option)
            
            for _, btn in pairs(optionsFrame:GetChildren()) do
                if btn:IsA("TextButton") then
                    Services.TweenService:Create(btn, TweenInfo.new(0.2), {
                        BackgroundColor3 = Color3.fromRGB(242, 242, 247),
                        TextColor3 = Color3.fromRGB(0, 0, 0)
                    }):Play()
                end
            end
            
            Services.TweenService:Create(optionBtn, TweenInfo.new(0.2), {
                BackgroundColor3 = Config.AccentColor,
                TextColor3 = Color3.fromRGB(255, 255, 255)
            }):Play()
            
            isOpen = false
            Services.TweenService:Create(optionsFrame, TweenInfo.new(0.2), {
                Size = UDim2.new(0.6, -16, 0, 0)
            }):Play()
            wait(0.2)
            optionsFrame.Visible = false
        end)
    end
    
    return dropdownFrame
end

local espColorPalette = {
    Color3.fromRGB(0, 122, 255),
    Color3.fromRGB(52, 199, 89),
    Color3.fromRGB(255, 59, 48),
    Color3.fromRGB(255, 149, 0),
    Color3.fromRGB(175, 82, 222),
    Color3.fromRGB(255, 45, 85),
    Color3.fromRGB(90, 200, 250),
    Color3.fromRGB(255, 204, 0)
}

local function createColorPicker(name, order, defaultColor, callback, isESP)
    local pickerFrame = Instance.new("Frame")
    pickerFrame.Size = UDim2.new(0, scrollFrame.AbsoluteSize.X - 12, 0, isESP and 100 or 52)
    pickerFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    pickerFrame.BorderSizePixel = 0
    pickerFrame.BackgroundTransparency = 0.3
    pickerFrame.LayoutOrder = order
    pickerFrame.Parent = scrollFrame
    
    local pickerCorner = Instance.new("UICorner", pickerFrame)
    pickerCorner.CornerRadius = UDim.new(0, 16)
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.65, 0, 0, 30)
    label.Position = UDim2.new(0, 16, 0, 10)
    label.Text = name
    label.TextColor3 = Color3.fromRGB(0, 0, 0)
    label.TextSize = 15
    label.Font = Enum.Font.Gotham
    label.BackgroundTransparency = 1
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.TextYAlignment = Enum.TextYAlignment.Center
    label.Parent = pickerFrame
    
    if isESP then
        local colorGrid = Instance.new("Frame")
        colorGrid.Size = UDim2.new(1, -32, 0, 50)
        colorGrid.Position = UDim2.new(0, 16, 0, 40)
        colorGrid.BackgroundTransparency = 1
        colorGrid.Parent = pickerFrame
        
        local gridLayout = Instance.new("UIGridLayout")
        gridLayout.CellSize = UDim2.new(0, 35, 0, 35)
        gridLayout.CellPadding = UDim2.new(0, 10, 0, 10)
        gridLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
        gridLayout.Parent = colorGrid
        
        for _, color in ipairs(espColorPalette) do
            local colorBtn = Instance.new("TextButton")
            colorBtn.Size = UDim2.new(0, 35, 0, 35)
            colorBtn.BackgroundColor3 = color
            colorBtn.Text = ""
            colorBtn.BorderSizePixel = 0
            colorBtn.Parent = colorGrid
            
            local colorBtnCorner = Instance.new("UICorner", colorBtn)
            colorBtnCorner.CornerRadius = UDim.new(1, 0)
            
            local selected = Instance.new("UIStroke", colorBtn)
            selected.Color = Color3.fromRGB(255, 255, 255)
            selected.Thickness = 3
            selected.Transparency = color == defaultColor and 0 or 1
            
            colorBtn.MouseButton1Click:Connect(function()
                for _, otherBtn in ipairs(colorGrid:GetChildren()) do
                    if otherBtn:IsA("TextButton") then
                        local stroke = otherBtn:FindFirstChildOfClass("UIStroke")
                        if stroke then
                            Services.TweenService:Create(stroke, TweenInfo.new(0.2), {
                                Transparency = 1
                            }):Play()
                        end
                    end
                end
                
                Services.TweenService:Create(selected, TweenInfo.new(0.2), {
                    Transparency = 0
                }):Play()
                
                callback(color)
            end)
        end
    else
        local colorGrid = Instance.new("Frame")
        colorGrid.Size = UDim2.new(1, -32, 0, 50)
        colorGrid.Position = UDim2.new(0, 16, 0, 40)
        colorGrid.BackgroundTransparency = 1
        colorGrid.Parent = pickerFrame
        
        local gridLayout = Instance.new("UIGridLayout")
        gridLayout.CellSize = UDim2.new(0, 35, 0, 35)
        gridLayout.CellPadding = UDim2.new(0, 10, 0, 10)
        gridLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left
        gridLayout.Parent = colorGrid
        
        pickerFrame.Size = UDim2.new(0, scrollFrame.AbsoluteSize.X - 12, 0, 100)
        
        for _, color in ipairs(espColorPalette) do
            local colorBtn = Instance.new("TextButton")
            colorBtn.Size = UDim2.new(0, 35, 0, 35)
            colorBtn.BackgroundColor3 = color
            colorBtn.Text = ""
            colorBtn.BorderSizePixel = 0
            colorBtn.Parent = colorGrid
            
            local colorBtnCorner = Instance.new("UICorner", colorBtn)
            colorBtnCorner.CornerRadius = UDim.new(1, 0)
            
            local selected = Instance.new("UIStroke", colorBtn)
            selected.Color = Color3.fromRGB(255, 255, 255)
            selected.Thickness = 3
            selected.Transparency = color == defaultColor and 0 or 1
            
            colorBtn.MouseButton1Click:Connect(function()
                for _, otherBtn in ipairs(colorGrid:GetChildren()) do
                    if otherBtn:IsA("TextButton") then
                        local stroke = otherBtn:FindFirstChildOfClass("UIStroke")
                        if stroke then
                            Services.TweenService:Create(stroke, TweenInfo.new(0.2), {
                                Transparency = 1
                            }):Play()
                        end
                    end
                end
                
                Services.TweenService:Create(selected, TweenInfo.new(0.2), {
                    Transparency = 0
                }):Play()
                
                updateGUIColors(color)
                callback(color)
            end)
        end
    end
    
    return pickerFrame
end

local function createKeybindPicker(name, order, defaultKey, callback)
    local keybindFrame = Instance.new("Frame")
    keybindFrame.Name = "KeybindFrame"
    keybindFrame.Size = UDim2.new(0, scrollFrame.AbsoluteSize.X - 12, 0, 52)
    keybindFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    keybindFrame.BorderSizePixel = 0
    keybindFrame.BackgroundTransparency = 0.3
    keybindFrame.LayoutOrder = order
    keybindFrame.Parent = scrollFrame
    
    local keybindCorner = Instance.new("UICorner", keybindFrame)
    keybindCorner.CornerRadius = UDim.new(0, 16)
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.5, 0, 1, 0)
    label.Position = UDim2.new(0, 16, 0, 0)
    label.Text = name
    label.TextColor3 = Color3.fromRGB(0, 0, 0)
    label.TextSize = 15
    label.Font = Enum.Font.Gotham
    label.BackgroundTransparency = 1
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.TextYAlignment = Enum.TextYAlignment.Center
    label.Parent = keybindFrame
    
    local keybindBtn = Instance.new("TextButton")
    keybindBtn.Size = UDim2.new(0, 80, 0, 36)
    keybindBtn.Position = UDim2.new(1, -96, 0.5, -18)
    keybindBtn.BackgroundColor3 = Color3.fromRGB(242, 242, 247)
    keybindBtn.Text = defaultKey.Name
    keybindBtn.TextColor3 = Config.AccentColor
    keybindBtn.TextSize = 14
    keybindBtn.Font = Enum.Font.GothamMedium
    keybindBtn.BorderSizePixel = 0
    keybindBtn.Parent = keybindFrame
    
    local keybindCorner2 = Instance.new("UICorner", keybindBtn)
    keybindCorner2.CornerRadius = UDim.new(0, 10)
    
    local listening = false
    
    keybindBtn.MouseButton1Click:Connect(function()
        listening = true
        keybindBtn.Text = "..."
        keybindBtn.TextColor3 = Color3.fromRGB(255, 149, 0)
        
        local connection
        connection = Services.UserInputService.InputBegan:Connect(function(input, processed)
            if processed then return end
            if input.UserInputType == Enum.UserInputType.Keyboard then
                listening = false
                keybindBtn.Text = input.KeyCode.Name
                keybindBtn.TextColor3 = Config.AccentColor
                callback(input.KeyCode)
                connection:Disconnect()
            end
        end)
    end)
    
    return keybindFrame
end

local shutdownBtn = Instance.new("TextButton")
shutdownBtn.Size = UDim2.new(0, scrollFrame.AbsoluteSize.X - 12, 0, 55)
shutdownBtn.Position = UDim2.new(0, 0, 0, 0)
shutdownBtn.BackgroundColor3 = Color3.fromRGB(255, 59, 48)
shutdownBtn.Text = "Shutdown Script"
shutdownBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
shutdownBtn.TextSize = 17
shutdownBtn.Font = Enum.Font.GothamBold
shutdownBtn.BorderSizePixel = 0
shutdownBtn.BackgroundTransparency = 0.15
shutdownBtn.LayoutOrder = 999
shutdownBtn.Parent = scrollFrame

local shutdownCorner = Instance.new("UICorner", shutdownBtn)
shutdownCorner.CornerRadius = UDim.new(0, 16)

shutdownBtn.MouseButton1Click:Connect(function()
    shutdownBtn.Text = "Shutting down..."
    shutdownBtn.BackgroundColor3 = Color3.fromRGB(200, 40, 30)
    
    scriptEnabled = false
    Config.Enabled = false
    Config.ESP.Enabled = false
    isSpeedEnabled = false
    
    FOVCircle.Visible = false
    TargetIndicator.Visible = false
    MultipointCircle.Visible = false
    
    for player, esp in pairs(ESPObjects) do
        removeESP(player)
    end
    
    wait(0.5)
    
    Services.TweenService:Create(mainFrame, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.In), {
        Size = UDim2.new(0, 0, 0, 0),
        Position = UDim2.new(0.5, 0, 0.5, 0)
    }):Play()
    
    Services.TweenService:Create(blurEffect, TweenInfo.new(0.4), {
        Size = 0
    }):Play()
    
    wait(0.4)
    gui:Destroy()
    blurEffect:Destroy()
end)

-- СОЗДАНИЕ UI ЭЛЕМЕНТОВ

createModuleSection("Combat", 1)

local gridContainer1 = Instance.new("Frame")
gridContainer1.Size = UDim2.new(0, scrollFrame.AbsoluteSize.X - 12, 0, 290)
gridContainer1.BackgroundTransparency = 1
gridContainer1.LayoutOrder = 2
gridContainer1.Parent = scrollFrame

local gridLayout1 = Instance.new("UIGridLayout")
gridLayout1.CellSize = UDim2.new(0, 120, 0, 135)
gridLayout1.CellPadding = UDim2.new(0, 15, 0, 15)
gridLayout1.HorizontalAlignment = Enum.HorizontalAlignment.Center
gridLayout1.Parent = gridContainer1

createCircleButton("Silent Aim", 1, Config.Enabled, function(value)
    Config.Enabled = value
end).Parent = gridContainer1

createCircleButton("Team Check", 2, Config.TeamCheck, function(value)
    Config.TeamCheck = value
end).Parent = gridContainer1

createCircleButton("Wall Check", 3, Config.WallCheck, function(value)
    Config.WallCheck = value
end).Parent = gridContainer1

createCircleButton("Show FOV", 4, Config.ShowFOV, function(value)
    Config.ShowFOV = value
end).Parent = gridContainer1

createCircleButton("Resolver", 5, Config.Resolver, function(value)
    Config.Resolver = value
end).Parent = gridContainer1

createCircleButton("Multipoint", 6, Config.Multipoint, function(value)
    Config.Multipoint = value
    if value then
        MultipointCircle.Visible = Config.ShowFOV
    else
        MultipointCircle.Visible = false
    end
end).Parent = gridContainer1

createModuleSection("Combat Settings", 3)

createModernSlider("FOV Size", 4, 20, 500, Config.FOVSize, function(value)
    Config.FOVSize = value
end, false)

createModernSlider("Max Distance", 5, 100, 1000, Config.MaxDistance, function(value)
    Config.MaxDistance = value
    Config.CurrentMaxDistance = value
end, false)

createModernSlider("Multipoint Size", 6, 1, 10, Config.MultipointSize, function(value)
    Config.MultipointSize = value
end, true)

-- УЛУЧШЕННЫЙ DROPDOWN ДЛЯ TARGET PART
local function createImprovedDropdown(name, order, options, defaultValue, callback)
    local dropdownFrame = Instance.new("Frame")
    dropdownFrame.Size = UDim2.new(0, scrollFrame.AbsoluteSize.X - 12, 0, 52)
    dropdownFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    dropdownFrame.BorderSizePixel = 0
    dropdownFrame.BackgroundTransparency = 0.3  -- ИЗМЕНЕНО: было 1
    dropdownFrame.LayoutOrder = order
    dropdownFrame.ClipsDescendants = false
    dropdownFrame.Parent = scrollFrame
    
    local dropdownCorner = Instance.new("UICorner", dropdownFrame)
    dropdownCorner.CornerRadius = UDim.new(0, 16)
    
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(0.35, 0, 1, 0)
    label.Position = UDim2.new(0, 16, 0, 0)
    label.Text = name
    label.TextColor3 = Color3.fromRGB(0, 0, 0)
    label.TextSize = 15
    label.Font = Enum.Font.Gotham
    label.BackgroundTransparency = 1
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.TextYAlignment = Enum.TextYAlignment.Center
    label.Parent = dropdownFrame
    
    local selectedBtn = Instance.new("TextButton")
    selectedBtn.Size = UDim2.new(0.6, -16, 0, 36)
    selectedBtn.Position = UDim2.new(0.4, 0, 0.5, -18)
    selectedBtn.BackgroundColor3 = Color3.fromRGB(242, 242, 247)
    selectedBtn.Text = defaultValue
    selectedBtn.TextColor3 = Color3.fromRGB(0, 0, 0)
    selectedBtn.TextSize = 14
    selectedBtn.Font = Enum.Font.GothamMedium
    selectedBtn.BorderSizePixel = 0
    selectedBtn.Parent = dropdownFrame
    
    local selectedCorner = Instance.new("UICorner", selectedBtn)
    selectedCorner.CornerRadius = UDim.new(0, 10)
    
    local arrow = Instance.new("TextLabel")
    arrow.Size = UDim2.new(0, 20, 1, 0)
    arrow.Position = UDim2.new(1, -25, 0, 0)
    arrow.Text = "▼"
    arrow.TextColor3 = Color3.fromRGB(142, 142, 147)
    arrow.TextSize = 10
    arrow.Font = Enum.Font.GothamBold
    arrow.BackgroundTransparency = 1
    arrow.Parent = selectedBtn
    
    -- ИЗМЕНЕНО: Теперь optionsFrame - прямой потомок gui, а не dropdownFrame
    local optionsFrame = Instance.new("ScrollingFrame")
    optionsFrame.Size = UDim2.new(0, 0, 0, 0)
    optionsFrame.Position = UDim2.new(0, 0, 0, 0)
    optionsFrame.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    optionsFrame.BorderSizePixel = 0
    optionsFrame.Visible = false
    optionsFrame.ClipsDescendants = true
    optionsFrame.ZIndex = 1000  -- ИЗМЕНЕНО: Увеличен ZIndex
    optionsFrame.ScrollBarThickness = 4
    optionsFrame.ScrollBarImageColor3 = Color3.fromRGB(142, 142, 147)
    optionsFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
    optionsFrame.Parent = gui  -- ИЗМЕНЕНО: Теперь родитель - gui
    
    local optionsCorner = Instance.new("UICorner", optionsFrame)
    optionsCorner.CornerRadius = UDim.new(0, 12)
    
    local optionsStroke = Instance.new("UIStroke", optionsFrame)
    optionsStroke.Color = Color3.fromRGB(210, 210, 215)
    optionsStroke.Thickness = 1
    optionsStroke.Transparency = 0.5
    
    local optionsLayout = Instance.new("UIListLayout", optionsFrame)
    optionsLayout.SortOrder = Enum.SortOrder.LayoutOrder
    optionsLayout.Padding = UDim.new(0, 2)
    
    optionsLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        optionsFrame.CanvasSize = UDim2.new(0, 0, 0, optionsLayout.AbsoluteContentSize.Y + 4)
    end)
    
    local isOpen = false
    
    -- ДОБАВЛЕНО: Функция для обновления позиции optionsFrame
    local function updateOptionsPosition()
        local btnPos = selectedBtn.AbsolutePosition
        local btnSize = selectedBtn.AbsoluteSize
        optionsFrame.Position = UDim2.new(0, btnPos.X, 0, btnPos.Y + btnSize.Y + 4)
        optionsFrame.Size = UDim2.new(0, btnSize.X, 0, optionsFrame.Size.Y.Offset)
    end
    
    selectedBtn.MouseButton1Click:Connect(function()
        isOpen = not isOpen
        
        if isOpen then
            updateOptionsPosition()  -- ДОБАВЛЕНО: Обновляем позицию перед показом
            optionsFrame.Visible = true
            local targetHeight = math.min(#options * 38 + 4, 200)
            Services.TweenService:Create(optionsFrame, TweenInfo.new(0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
                Size = UDim2.new(0, selectedBtn.AbsoluteSize.X, 0, targetHeight)
            }):Play()
            Services.TweenService:Create(arrow, TweenInfo.new(0.2), {
                Rotation = 180
            }):Play()
        else
            Services.TweenService:Create(optionsFrame, TweenInfo.new(0.2), {
                Size = UDim2.new(0, selectedBtn.AbsoluteSize.X, 0, 0)
            }):Play()
            Services.TweenService:Create(arrow, TweenInfo.new(0.2), {
                Rotation = 0
            }):Play()
            wait(0.2)
            optionsFrame.Visible = false
        end
    end)
    
    -- ДОБАВЛЕНО: Обновляем позицию при изменении размера окна или скролле
    Services.RunService.RenderStepped:Connect(function()
        if isOpen and optionsFrame.Visible then
            updateOptionsPosition()
        end
    end)
    
    -- ДОБАВЛЕНО: Закрываем dropdown при клике вне его
    Services.UserInputService.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 and isOpen then
            local mousePos = Services.UserInputService:GetMouseLocation()
            local btnPos = selectedBtn.AbsolutePosition
            local btnSize = selectedBtn.AbsoluteSize
            local optPos = optionsFrame.AbsolutePosition
            local optSize = optionsFrame.AbsoluteSize
            
            local inButton = mousePos.X >= btnPos.X and mousePos.X <= btnPos.X + btnSize.X and
                           mousePos.Y >= btnPos.Y and mousePos.Y <= btnPos.Y + btnSize.Y
            
            local inOptions = mousePos.X >= optPos.X and mousePos.X <= optPos.X + optSize.X and
                            mousePos.Y >= optPos.Y and mousePos.Y <= optPos.Y + optSize.Y
            
            if not inButton and not inOptions then
                isOpen = false
                Services.TweenService:Create(optionsFrame, TweenInfo.new(0.2), {
                    Size = UDim2.new(0, selectedBtn.AbsoluteSize.X, 0, 0)
                }):Play()
                Services.TweenService:Create(arrow, TweenInfo.new(0.2), {
                    Rotation = 0
                }):Play()
                wait(0.2)
                optionsFrame.Visible = false
            end
        end
    end)
    
    for i, option in ipairs(options) do
        local optionBtn = Instance.new("TextButton")
        optionBtn.Size = UDim2.new(1, -4, 0, 36)
        optionBtn.Position = UDim2.new(0, 2, 0, 0)
        optionBtn.BackgroundColor3 = option == defaultValue and Config.AccentColor or Color3.fromRGB(242, 242, 247)
        optionBtn.Text = option
        optionBtn.TextColor3 = option == defaultValue and Color3.fromRGB(255, 255, 255) or Color3.fromRGB(0, 0, 0)
        optionBtn.TextSize = 13
        optionBtn.Font = Enum.Font.Gotham
        optionBtn.BorderSizePixel = 0
        optionBtn.LayoutOrder = i
        optionBtn.ZIndex = 1001  -- ДОБАВЛЕНО: ZIndex для кнопок
        optionBtn.Parent = optionsFrame
        
        local optionCorner = Instance.new("UICorner", optionBtn)
        optionCorner.CornerRadius = UDim.new(0, 8)
        
        local checkmark = Instance.new("TextLabel")
        checkmark.Size = UDim2.new(0, 20, 1, 0)
        checkmark.Position = UDim2.new(1, -25, 0, 0)
        checkmark.Text = option == defaultValue and "✓" or ""
        checkmark.TextColor3 = Color3.fromRGB(255, 255, 255)
        checkmark.TextSize = 16
        checkmark.Font = Enum.Font.GothamBold
        checkmark.BackgroundTransparency = 1
        checkmark.ZIndex = 1002  -- ДОБАВЛЕНО: ZIndex для галочки
        checkmark.Parent = optionBtn
        
        optionBtn.MouseButton1Click:Connect(function()
            selectedBtn.Text = option
            callback(option)
            
            for _, btn in pairs(optionsFrame:GetChildren()) do
                if btn:IsA("TextButton") then
                    local check = btn:FindFirstChild("TextLabel")
                    Services.TweenService:Create(btn, TweenInfo.new(0.2), {
                        BackgroundColor3 = Color3.fromRGB(242, 242, 247),
                        TextColor3 = Color3.fromRGB(0, 0, 0)
                    }):Play()
                    if check then
                        check.Text = ""
                    end
                end
            end
            
            Services.TweenService:Create(optionBtn, TweenInfo.new(0.2), {
                BackgroundColor3 = Config.AccentColor,
                TextColor3 = Color3.fromRGB(255, 255, 255)
            }):Play()
            checkmark.Text = "✓"
            
            isOpen = false
            Services.TweenService:Create(optionsFrame, TweenInfo.new(0.2), {
                Size = UDim2.new(0, selectedBtn.AbsoluteSize.X, 0, 0)
            }):Play()
            Services.TweenService:Create(arrow, TweenInfo.new(0.2), {
                Rotation = 0
            }):Play()
            wait(0.2)
            optionsFrame.Visible = false
        end)
    end
    
    return dropdownFrame
end

createImprovedDropdown("Target Part", 7, {
    "Head",
    "UpperTorso",
    "Closest Point",
    "LowerTorso",
    "HumanoidRootPart",
    "LeftUpperArm",
    "LeftLowerArm",
    "LeftHand",
    "RightUpperArm",
    "RightLowerArm",
    "RightHand",
    "LeftUpperLeg",
    "LeftLowerLeg",
    "LeftFoot",
    "RightUpperLeg",
    "RightLowerLeg",
    "RightFoot",   
}, Config.HitPart, function(value)
    Config.HitPart = value
    cachedTarget = nil
    cachedTargetPoint = nil
end)

createKeybindPicker("Silent Aim Key", 8, Config.Keybind, function(key)
    Config.Keybind = key
end)

createModuleSection("Rapid Fire", 9)

createCompactToggle("Rapid Fire", 10, Config.RapidFire, function(value)
    Config.RapidFire = value
    setupRapidFire()
end)

createModernSlider("Fire Delay", 11, 0.01, 0.5, Config.RapidFireDelay, function(value)
    Config.RapidFireDelay = value
end, true)

createModuleSection("Spread Modifier", 12)

createCompactToggle("Reduce Spread", 13, SpreadMod.BulletSpread.Enabled, function(value)
    SpreadMod.BulletSpread.Enabled = value
end)

createModernSlider("Spread Amount", 14, 0, 100, SpreadMod.BulletSpread.Amount, function(value)
    SpreadMod.BulletSpread.Amount = value
end, false)

createModuleSection("Walk Speed", 15)

createCompactToggle("Speed Enabled", 16, isSpeedEnabled, function(value)
    isSpeedEnabled = value
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        saveOriginalSpeed()
        updateSpeed()
    end
end)

createModernSlider("Walk Speed", 17, 16, 500, currentWalkSpeed, function(value)
    currentWalkSpeed = value
    if isSpeedEnabled then
        updateSpeed()
    end
end, false)

createKeybindPicker("Speed Toggle Key", 18, currentSpeedKeybind, function(key)
    currentSpeedKeybind = key
end)

createModuleSection("ESP Settings", 19)

local gridContainer2 = Instance.new("Frame")
gridContainer2.Size = UDim2.new(0, scrollFrame.AbsoluteSize.X - 12, 0, 290)
gridContainer2.BackgroundTransparency = 1
gridContainer2.LayoutOrder = 20
gridContainer2.Parent = scrollFrame

local gridLayout2 = Instance.new("UIGridLayout")
gridLayout2.CellSize = UDim2.new(0, 120, 0, 135)
gridLayout2.CellPadding = UDim2.new(0, 15, 0, 15)
gridLayout2.HorizontalAlignment = Enum.HorizontalAlignment.Center
gridLayout2.Parent = gridContainer2

createCircleButton("ESP", 1, Config.ESP.Enabled, function(value)
    Config.ESP.Enabled = value
end).Parent = gridContainer2

createCircleButton("Box", 2, Config.ESP.ShowBox, function(value)
    Config.ESP.ShowBox = value
end).Parent = gridContainer2

createCircleButton("Name", 3, Config.ESP.ShowName, function(value)
    Config.ESP.ShowName = value
end).Parent = gridContainer2

createCircleButton("Distance", 4, Config.ESP.ShowDistance, function(value)
    Config.ESP.ShowDistance = value
end).Parent = gridContainer2

createCircleButton("Health", 5, Config.ESP.ShowHealth, function(value)
    Config.ESP.ShowHealth = value
end).Parent = gridContainer2

createCircleButton("Skeleton", 6, Config.ESP.ShowSkeleton, function(value)
    Config.ESP.ShowSkeleton = value
end).Parent = gridContainer2

createModuleSection("ESP Colors", 21)

createColorPicker("Box Color", 22, Config.ESP.BoxColor, function(color)
    Config.ESP.BoxColor = color
end, true)

createColorPicker("Name Color", 23, Config.ESP.NameColor, function(color)
    Config.ESP.NameColor = color
end, true)

createColorPicker("Distance Color", 24, Config.ESP.DistanceColor, function(color)
    Config.ESP.DistanceColor = color
end, true)

createColorPicker("Skeleton Color", 25, Config.ESP.SkeletonColor, function(color)
    Config.ESP.SkeletonColor = color
end, true)

createModernSlider("ESP Distance", 26, 100, 1000, Config.ESP.MaxDistance, function(value)
    Config.ESP.MaxDistance = value
end, false)

createCompactToggle("ESP Team Check", 27, Config.ESP.TeamCheck, function(value)
    Config.ESP.TeamCheck = value
end)

createModuleSection("GUI Settings", 28)

createColorPicker("GUI Accent Color", 29, Config.AccentColor, function(color)
    updateGUIColors(color)
end, false)

createKeybindPicker("Toggle GUI", 30, Config.GUIToggleKey, function(key)
    Config.GUIToggleKey = key
end)
